package com.means.rabbit.base;import net.duohuo.dhroid.activity.BaseActivity;import net.duohuo.dhroid.dialog.IDialog;import net.duohuo.dhroid.ioc.IocContainer;import net.duohuo.dhroid.net.DhNet;import net.duohuo.dhroid.net.NetTask;import net.duohuo.dhroid.net.Response;import net.duohuo.dhroid.util.ViewUtil;import android.annotation.SuppressLint;import android.app.Activity;import android.app.Dialog;import android.content.Intent;import android.os.Bundle;import android.text.TextUtils;import android.view.View;import android.view.View.OnClickListener;import android.widget.ImageView;import android.widget.TextView;import com.means.rabbit.R;import com.means.rabbit.api.API;import com.means.rabbit.manage.UserInfoManage;import com.means.rabbit.manage.UserInfoManage.LoginCallBack;public abstract class RabbitBaseActivity extends BaseActivity {	public IDialog dialoger;	public Activity self;	Integer dialogcount = 0;	Dialog progressdialog;	public static final String CONNECTIVITY_CHANGE_ACTION = "android.net.conn.CONNECTIVITY_CHANGE";	@Override	protected void onCreate(Bundle savedInstanceState) {		// TODO Auto-generated method stub		super.onCreate(savedInstanceState);		dialoger = IocContainer.getShare().get(IDialog.class);		self = this;	}	@Override	protected void onStart() {		super.onStart();		// IntentFilter filter = new IntentFilter();		// filter.addAction(CONNECTIVITY_CHANGE_ACTION);		// registerReceiver(netReceiver, filter);	}	@Override	public void setContentView(int layoutResID) {		super.setContentView(layoutResID);		initTitleBar();		initView();	}	private void initTitleBar() {		View backV = findViewById(R.id.backLayout);		if (backV != null) {			backV.setOnClickListener(new OnClickListener() {				@Override				public void onClick(View arg0) {					finish();				}			});		}	}	public abstract void initView();	/**	 * 左边返回按钮为空	 */	public void setLeftIconGone() {		ImageView backV = (ImageView) findViewById(R.id.back);		if (backV != null) {			backV.setVisibility(View.GONE);		}	}	/**	 * 设置标题	 */	public void setTitle(String text) {		TextView titleT = (TextView) findViewById(R.id.title);		if (titleT != null) {			titleT.setText(text);		}	}	/**	 * 设置左边的点击事件	 */	public void setLeftAction(int leftid, String leftText,			OnClickListener listener) {		ImageView backV = (ImageView) findViewById(R.id.back);		if (backV != null) {			if (leftid == -1) {				backV.setVisibility(View.VISIBLE);			} else if (leftid == -2) {				backV.setVisibility(View.GONE);			} else {				backV.setVisibility(View.VISIBLE);				backV.setImageResource(leftid);			}			if (listener != null) {				View backLV = findViewById(R.id.backLayout);				if (backLV != null) {					backLV.setOnClickListener(listener);				}			}		}		TextView leftTextT = (TextView) findViewById(R.id.left_text);		if (leftText != null) {			if (leftTextT != null) {				leftTextT.setText(leftText);				leftTextT.setVisibility(View.VISIBLE);			}		} else {			leftTextT.setVisibility(View.INVISIBLE);		}	}	/**	 * 设置右面的点击事件	 */	public void setRightAction(int resid, OnClickListener listener) {		ImageView rightI = (ImageView) findViewById(R.id.right_icon);		if (rightI != null) {			if (resid != -1) {				rightI.setVisibility(View.VISIBLE);				rightI.setImageResource(resid);				rightI.setOnClickListener(listener);			} else {				rightI.setVisibility(View.GONE);			}		}	}	public void setRightAction2(int resid, OnClickListener listener) {		ImageView rightI = (ImageView) findViewById(R.id.right_icon2);		if (rightI != null) {			if (resid != -1) {				rightI.setVisibility(View.VISIBLE);				rightI.setImageResource(resid);				rightI.setOnClickListener(listener);			} else {				rightI.setVisibility(View.GONE);			}		}	}	public void setRightAction2(int iscollect, final String contentid,			final String type) {		final ImageView rightI = (ImageView) findViewById(R.id.right_icon2);		rightI.setVisibility(View.VISIBLE);		rightI.setTag(iscollect);		ViewUtil.bindView(rightI, iscollect == 0 ? R.drawable.fav_n				: R.drawable.fav_f);		rightI.setOnClickListener(new OnClickListener() {			@Override			public void onClick(View arg0) {				UserInfoManage.getInstance().checkLogin(self,						new LoginCallBack() {							@Override							public void onisLogin() {								if (rightI.getTag().toString().equals("0")) {									collect(contentid, type);								} else {									delcollect(contentid, type);								}							}							@Override							public void onLoginFail() {							}						});			}		});	}	@Override	public void startActivity(Intent intent) {		// TODO Auto-generated method stub		super.startActivity(intent);		// modalInAnim();	}	@Override	public void finish() {		super.finish();		popOutAnim();	}	public void finishWithoutAnim() {		super.finish();	}	public void finishAnim() {		super.finish();		modalOutAnim();	}	@SuppressLint("NewApi")	public void popInAnim() {		overridePendingTransition(R.anim.push_right_in, R.anim.push_left_out);	}	/**	 * 左右滑动切换页面的动画 后退	 */	@SuppressLint("NewApi")	public void popOutAnim() {		overridePendingTransition(R.anim.push_left_in, R.anim.push_right_out);	}	/**	 * 向上推出时切换的动画 进入	 */	@SuppressLint("NewApi")	public void modalInAnim() {		overridePendingTransition(R.anim.slide_up_in, R.anim.fade_out);	}	/**	 * 向上推出时切换的动画 后退	 */	public void modalOutAnim() {		overridePendingTransition(R.anim.dialog_enter, R.anim.dialog_exit);	}	/**	 * 弹出提示框	 * 	 * @param msg	 */	public void showToast(String msg) {		dialoger.showToastShort(getApplicationContext(), msg);	}	/**	 * 显示加载框	 * 	 * @param msg	 * @return	 */	public Dialog showProgressDialog(String msg) {		if (TextUtils.isEmpty(msg))			msg = getString(R.string.progress_doing);		synchronized (dialogcount) {			dialogcount++;		}		System.out.println("show" + dialogcount);		if (progressdialog == null || !progressdialog.isShowing()) {			progressdialog = dialoger.showProgressDialog(this, msg);			System.out.print("progress dlg:"					+ dialoger.getClass().getSimpleName());		}		return progressdialog;	}	/**	 * dismiss加载框	 */	public void hidenProgressDialog() {		synchronized (dialogcount) {			dialogcount--;		}		System.out.println("hiden" + dialogcount);		// if (dialogcount == 0) {		if (progressdialog != null) {			progressdialog.dismiss();		}		// }	}	@Override	protected void onStop() {		super.onStop();	}	@Override	protected void onPause() {		super.onPause();	}	@Override	protected void onResume() {		super.onResume();	}	@Override	protected void onDestroy() {		// TODO Auto-generated method stub		super.onDestroy();	}	private void collect(String contentid, String type) {		DhNet net = new DhNet(API.collect);		net.addParam("contentid", contentid);		net.addParam("type", type);		net.doPostInDialog(new NetTask(self) {			@Override			public void doInUI(Response response, Integer transfer) {				if (response.isSuccess()) {					showToast("收藏成功!");					findViewById(R.id.right_icon2).setTag(1);					ViewUtil.bindView(findViewById(R.id.right_icon2),							R.drawable.fav_f);				}			}		});	}	private void delcollect(String contentid, String type) {		DhNet net = new DhNet(API.collectdel);		net.addParam("contentid", contentid);		net.addParam("type", type);		net.doPostInDialog(new NetTask(self) {			@Override			public void doInUI(Response response, Integer transfer) {				if (response.isSuccess()) {					showToast("取消收藏成功!");					findViewById(R.id.right_icon2).setTag(0);					ViewUtil.bindView(findViewById(R.id.right_icon2),							R.drawable.fav_n);				}			}		});	}}